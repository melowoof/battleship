var T=d=>{throw TypeError(d)};var B=(d,t,e)=>t.has(d)||T("Cannot "+e);var l=(d,t,e)=>(B(d,t,"read from private field"),e?e.call(d):t.get(d)),$=(d,t,e)=>t.has(d)?T("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(d):t.set(d,e);var h=(d,t,e)=>(B(d,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();class S{constructor(t,e,s="horizontal",i=0,r=!1){this.name=t,this.length=e,this.beenHit=i,this.sunk=r,this.direction=s}hit(){this.beenHit++,this.isSunk()}isSunk(){this.length===this.beenHit&&(this.sunk=!0)}}class X{constructor(t=10){this.size=t,this.gameboard=this.initGameboard(this.size),this.shipsArray=[],this.shipPlacements=new Map}initGameboard(){const t=new Map;for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++)t.set(`${e},${s}`,{hit:!1,ship:null});return t}getX(t){return Number(t.split(",")[0])}getY(t){return Number(t.split(",")[1])}resetBoard(){this.shipsArray.length=0,this.shipPlacements.clear();for(let t=0;t<this.size;t++)for(let e=0;e<this.size;e++)this.gameboard.set(`${t},${e}`,{hit:!1,ship:null})}isAdjacentToShip(t){const e=this.getX(t),s=this.getY(t);return[[e-1,s-1],[e+0,s-1],[e+1,s-1],[e-1,s+0],[e+1,s+0],[e-1,s+1],[e+0,s+1],[e+1,s+1]].some(([r,a])=>r>=0&&r<10&&a>=0&&a<10&&this.gameboard.get(`${r},${a}`).ship)}isShipOnTile(t){const e=this.getX(t),s=this.getY(t);return this.gameboard.get(`${e},${s}`).ship}checkPlacement(t,e,s,i){const r=this.getX(t),a=this.getY(t);if(e=Number(e),this.isShipOnTile(t))return!1;if(s==="horizontal"){if(r+e>this.size)return!1;for(let n=r;n<r+e;n++)if(i(`${n},${a}`))return!1}else if(s==="vertical"){if(a+e>this.size)return!1;for(let n=a;n<a+e;n++)if(i(`${r},${n}`))return!1}return!0}isPlacementValid(t,e,s){return this.checkPlacement(t,e,s,i=>this.isAdjacentToShip(i))}getTilePlacements(t,e,s){this.getX(t),this.getY(t);const i=[];let r;for(let a=0;a<e;a++)s==="horizontal"?(r=`${Number(t.split(",")[0])+a},${t.split(",")[1]}`,i.push(r)):s==="vertical"&&(r=`${t.split(",")[0]},${Number(t.split(",")[1])+a}`,i.push(r));return i}placeShip(t,e){const s=t.direction;if(!this.isPlacementValid(e,t.length,t.direction))return!1;const i=this.getTilePlacements(e,t.length,t.direction);return t.direction=s,i.forEach(r=>{this.gameboard.get(r).ship=t}),this.shipsArray.push(t),this.shipPlacements.set(e,t),!0}removeShip(t){const e=this.getX(coords),s=this.getY(coords),i=this.gameboard.get(t).ship,r=i.length,a=i.direction;if(a==="horizontal")for(let n=e;n<e+r;n++)this.gameboard.set(`${n},${s}`,{ship:null});else if(a==="vertical")for(let n=s;n<s+r;n++)this.gameboard.set(`${e},${n}`,{ship:null})}receiveAttack(t){const e=this.gameboard.get(t);if(e.hit)return 0;if(!e.hit&&e.ship===null)return e.hit=!0,-1;if(!e.hit&&e.ship!==null)return e.hit=!0,e.ship.hit(),1}shipsLeft(){let t=0;for(let e=0;e<this.shipsArray.length;e++)this.shipsArray[e].sunk||t++;return t}randomPlaceShips(t){this.resetBoard();let e;t.forEach(s=>{let i;do e=`${Math.floor(Math.random()*10)},${Math.floor(Math.random()*10)}`,s.direction=Math.random()<.5?"horizontal":"vertical",i=this.placeShip(s,e);while(!i)})}}class w{constructor(t){this.type=t,this.gameboard=new X}attack(t,e){t.gameboard.receiveAttack(e)}receiveAttack(t){return this.gameboard.receiveAttack(t)}placeShip(t,e,s){return this.gameboard.placeShip(t,e,s)}randomPlaceShips(t){this.gameboard.randomPlaceShips(t)}resetBoard(){this.gameboard.resetBoard()}}var m,g,z,b,H,G,v;class Y{constructor(){$(this,b);$(this,m,{});$(this,g,new Map);$(this,z)}renderBoard(t,e){e.innerHTML="";const s=document.createDocumentFragment();for(let r=0;r<10;r++)for(let a=0;a<10;a++){const n=document.createElement("div"),u=t.gameboard.gameboard.get(`${a},${r}`);n.className="grid-cell",n.id=`${a},${r}`,n.dataset.x=a,n.dataset.y=r,u.hit&&(u.ship?n.classList.add("hit"):n.classList.add("miss")),s.appendChild(n)}e.appendChild(s),e.querySelectorAll(".grid-cell").forEach(r=>{const a=t.gameboard.gameboard.get(`${r.dataset.x},${r.dataset.y}`);a.hit&&(a.ship?r.classList.add("hit"):r.classList.add("miss"))})}renderClickHit(t,e){e.querySelectorAll(".grid-cell").forEach(i=>{i.addEventListener("click",r=>{t.gameboard.gameboard.get(`${r.target.dataset.x},${r.target.dataset.y}`).hit||(t.receiveAttack(`${r.target.dataset.x},${r.target.dataset.y}`),console.log("hit"),h(this,b,H).call(this,t,e,`${r.target.dataset.x},${r.target.dataset.y}`))})})}renderDragAndDrop(t,e){const s=e.querySelectorAll(".grid-cell"),i=[];s.forEach(r=>{r.addEventListener("dragover",a=>{a.preventDefault()}),r.addEventListener("dragenter",a=>{h(this,b,v).call(this);const n=Number(a.target.dataset.x),u=Number(a.target.dataset.y),f="rgb(144, 238, 144, 0.5)",y="rgb(255, 0, 0, 0.5)",L=t.gameboard.isPlacementValid(a.target.id,l(this,m).length,l(this,m).direction);i.length=0;let x=f;L===!1&&(x=y);for(let p=0;p<l(this,m).length;p++)l(this,m).direction==="horizontal"?i.push(`${n+p},${u}`):i.push(`${n},${u+p}`);i.forEach(p=>{const A=document.querySelector(`[data-x='${p.split(",")[0]}'][data-y='${p.split(",")[1]}']`);A&&(A.style.backgroundColor=x)})}),r.addEventListener("drop",a=>{a.preventDefault();const n=a.dataTransfer.getData("id"),u=a.target.id;t.placeShip(l(this,g).get(n),u)&&l(this,g).delete(n),this.renderShips(t,e),this.renderUnplacedShips(),h(this,b,v).call(this)})})}renderShips(t,e){e.querySelectorAll(".ship").forEach(i=>{i.remove()}),t.gameboard.shipPlacements.forEach((i,r)=>{const a=e.querySelector(`[data-x="${r.split(",")[0]}"][data-y="${r.split(",")[1]}"]`),n=document.createElement("div");n.id=r,i.direction==="horizontal"?(n.style.width=`${i.length*40}px`,n.style.height="40px"):i.direction==="vertical"&&(n.style.height=`${i.length*40}px`,n.style.width="40px"),n.className="ship",n.dataset.length=i.length,n.dataset.direction=i.direction,a.appendChild(n)})}updateStatus(t){const e=document.querySelector("#status");e.textContent=t}renderUnplacedShips(t=l(this,g)){const e=document.querySelector("#ships-container"),s=document.createDocumentFragment();e.innerHTML="",t.forEach((i,r)=>{i.direction="horizontal",l(this,g).set(r,i);const a=document.createElement("div");a.id=r,i.direction==="horizontal"?(a.style.width=`${i.length*40}px`,a.style.height="40px"):i.direction==="vertical"&&(a.style.height=`${i.length*40}px`,a.style.width="40px"),a.className="ship",a.draggable=!0,a.dataset.length=i.length,a.dataset.direction=i.direction,a.addEventListener("dragstart",n=>{l(this,m).length=n.target.dataset.length,l(this,m).direction=n.target.dataset.direction,n.dataTransfer.setData("length",i.length),n.dataTransfer.setData("direction",i.direction),n.dataTransfer.setData("id",n.target.id)}),a.addEventListener("click",n=>{i.direction=n.target.dataset.direction==="horizontal"?"vertical":"horizontal",n.target.dataset.direction==="horizontal"?(n.target.style.height=`${i.length*40}px`,n.target.style.width="40px",n.target.dataset.direction="vertical"):n.target.dataset.direction==="vertical"&&(n.target.style.width=`${i.length*40}px`,n.target.style.height="40px",n.target.dataset.direction="horizontal")}),s.appendChild(a)}),e.appendChild(s),this.playBtnAvailability()}playBtnAvailability(){const t=document.querySelector("#play");l(this,g).size===0?t.classList.remove("unavailable"):t.classList.add("unavailable")}buildAxis(){const t=document.querySelectorAll(".table-x-axis"),e=document.querySelectorAll(".table-y-axis");for(let s=1;s<=10;s++){const i=document.createElement("div"),r=document.createElement("div");i.innerHTML=String.fromCharCode(64+s).toUpperCase(),r.innerHTML=s,t.forEach(a=>{a.appendChild(i.cloneNode(!0))}),e.forEach(a=>{a.appendChild(r.cloneNode(!0))})}}randomPlaceShipsBtn(t,e,s,i){s.addEventListener("click",()=>{t.randomPlaceShips(e),this.renderShips(t,i),l(this,g).size>0&&l(this,g).clear(),this.renderUnplacedShips()})}resetShipsBtn(t,e,s,i){s.addEventListener("click",()=>{t.resetBoard(),this.renderBoard(t,i),this.renderDragAndDrop(t,i),this.renderUnplacedShips(e)})}}m=new WeakMap,g=new WeakMap,z=new WeakMap,b=new WeakSet,H=function(t,e,s){const i=t.gameboard.gameboard.get(s),r=e.querySelector(`[data-x="${s.split(",")[0]}"][data-y="${s.split(",")[1]}"]`);i.hit&&(i.ship?(r.classList.add("hit"),this.updateStatus("It's a hit! But you're probably just lucky")):(r.classList.add("miss"),this.updateStatus("Missed! Are you even trying?")))},G=function(t,e,s){const i=[],r=Number(t.split(",")[0]),a=Number(t.split(",")[1]);if(s==="horizontal")for(let n=0;n<e;n++){const u=document.querySelector(`[data-x='${r+n}'][data-y='${a}']`);i.push(u)}else if(s==="vertical")for(let n=0;n<e;n++){const u=document.querySelector(`[data-x='${r}'][data-y='${a+n}']`);i.push(u)}return i},v=function(){document.querySelectorAll(".grid-cell").forEach(e=>{e.style.backgroundColor=""})};var c,o,q,P,E,k,M,N,C,D,I,O;class j{constructor(t="HC"){$(this,o);$(this,c,new Y);this.gameMode=t,this.playersArray=h(this,o,q).call(this,t),this.shipsMap=h(this,o,P).call(this),this.shipsMap2=h(this,o,P).call(this),this.player1=this.playersArray[0],this.player2=this.playersArray[1],this.currentPlayerIndex=0,this.botLastHit=null}buildPlayer1PlaceShips(){const t=document.querySelector("#player1-table"),e=document.querySelector("#player2-table"),s=document.querySelector("#buttons-container"),i=document.createDocumentFragment(),r=document.createElement("button");r.classList.add("button"),r.id="randomize",r.innerHTML="Randomize",i.appendChild(r);const a=document.createElement("button");a.classList.add("button"),a.id="reset",a.innerHTML="Reset",i.appendChild(a);const n=document.createElement("button");n.classList.add("button"),n.id="play",n.innerHTML="Play",i.appendChild(n),s.appendChild(i),l(this,c).buildAxis(),l(this,c).renderBoard(this.player1,t),l(this,c).renderDragAndDrop(this.player1,t),l(this,c).renderBoard(this.player2,e),l(this,c).renderUnplacedShips(this.shipsMap),l(this,c).randomPlaceShipsBtn(this.player1,this.shipsMap,r,t),l(this,c).resetShipsBtn(this.player1,this.shipsMap,a,t),h(this,o,k).call(this,n)}}c=new WeakMap,o=new WeakSet,q=function(t){const e=new w("human");let s;return t==="HC"?s=new w("computer"):s=new w("human"),[e,s]},P=function(){const t=[],e=new Map;t.push(new S("Frigate",2)),t.push(new S("Cruiser",2)),t.push(new S("Destroyer",3)),t.push(new S("Submarine",3)),t.push(new S("Carrier",4)),t.push(new S("Tanker",5));for(let s=0;s<t.length;s++)e.set(`ship-${s}`,t[s]);return e},E=function(){this.currentPlayerIndex=(this.currentPlayerIndex+1)%this.playersArray.length},k=function(t){t.addEventListener("click",()=>{t.classList.contains("unavailable")||(this.gameMode==="HC"?h(this,o,N).call(this):this.gameMode==="HH"&&h(this,o,D).call(this))})},M=function(t,e){return!(t.gameboard.shipsLeft()>0&&e.gameboard.shipsLeft()>0)},N=function(){const t=document.querySelector("#player1-table"),e=document.querySelector("#player2-table"),s=document.querySelector("#buttons-container");s.innerHTML="",l(this,c).renderBoard(this.player1,t),l(this,c).renderShips(this.player1,t),l(this,c).renderBoard(this.player2,e),this.player2.randomPlaceShips(this.shipsMap2),h(this,o,C).call(this)},C=function(){h(this,o,M).call(this,this.player1,this.player2)||(this.currentPlayerIndex===0?h(this,o,I).call(this,this.player2,document.querySelector("#player2-table")):this.currentPlayerIndex===1&&h(this,o,O).call(this,this.player1,document.querySelector("#player1-table")))},D=function(){},I=function(t,e){const s=i=>{const r=`${i.target.dataset.x},${i.target.dataset.y}`;if(!t.gameboard.gameboard.get(r).hit){let a=t.receiveAttack(r);if(a===-1?l(this,c).updateStatus("Missed!"):a===1&&l(this,c).updateStatus("It's a hit! Keep going."),l(this,c).renderBoard(t,e),h(this,o,M).call(this,this.player1,this.player2)){l(this,c).updateStatus("Game over! Player wins!");return}a===-1&&h(this,o,E).call(this),e.removeEventListener("click",s),setTimeout(()=>h(this,o,C).call(this),200)}};e.removeEventListener("click",s),e.addEventListener("click",s)},O=function(t,e){var u;let s,i,r=["up","down","left","right"],a;const n=(f,y,L)=>{switch(L){case"up":return`${f},${y-1}`;case"down":return`${f},${y+1}`;case"left":return`${f-1},${y}`;case"right":return`${f+1},${y}`}};if(this.botLastHit){const[f,y]=this.botLastHit.split(",").map(Number);for(;r.length>0;){const L=Math.floor(Math.random()*r.length),x=r.splice(L,1)[0];a=n(f,y,x);const[p,A]=a.split(",").map(Number);if(p>=0&&p<10&&A>=0&&A<10&&!((u=t.gameboard.gameboard.get(a))!=null&&u.hit)&&(i=t.receiveAttack(a),console.log(`Attack on ${a} was a ${i}`),i))break}}if(!i)do s=`${Math.floor(Math.random()*10)},${Math.floor(Math.random()*10)}`,i=t.receiveAttack(s),console.log(`Fallback to random attack at ${s}, result: ${i}`);while(!i);if(l(this,c).renderBoard(t,e),l(this,c).renderShips(this.player1,e),i===1?(this.botLastHit=a||s,console.log(`New botLastHit set to ${this.botLastHit}`)):(this.botLastHit=null,console.log("Missed. botLastHit reset to null.")),h(this,o,M).call(this,this.player1,this.player2)){l(this,c).updateStatus("Game Over! Bot wins!");return}i===-1&&h(this,o,E).call(this),setTimeout(()=>h(this,o,C).call(this),500)};const F=new j;F.buildPlayer1PlaceShips();
